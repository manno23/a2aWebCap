# Advanced Scenarios Visualization

This document covers advanced patterns including authentication, error handling, concurrent connections, and edge cases.

## Scenario 1: Authentication Flow with Capability-Based Security

### Concept: CapnWeb's Capability Pattern

Traditional authentication sends credentials with every request. CapnWeb uses **capability-based security**:
- Authenticate ONCE
- Server returns a NEW authenticated stub
- All subsequent calls use that stub (no more credentials needed)
- Stub disposal automatically revokes access

### Flow Diagram

```
Client                                                          Server
  â”‚                                                               â”‚
  â”‚ 1. Connect to unauthenticated A2AService                      â”‚
  â”‚                                                               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RPC: authenticate({token: "abc123"}) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                                               â”‚
  â”‚                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                     â”‚ Validate token   â”‚
  â”‚                                                     â”‚ Check permissionsâ”‚
  â”‚                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                     â”‚ Create new stub:     â”‚
  â”‚                                                     â”‚ AuthenticatedA2A... â”‚
  â”‚                                                     â”‚ â€¢ userId: user-123   â”‚
  â”‚                                                     â”‚ â€¢ permissions: [...]  â”‚
  â”‚                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                                                               â”‚
  â”œâ—„â”€â”€â”€â”€â”€â”€â”€â”€ RPC Response: AuthenticatedA2AService stub â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚          (NEW RpcTarget with user context embedded)           â”‚
  â”‚                                                               â”‚
  â”‚ 2. Use authenticated stub for all subsequent calls            â”‚
  â”‚                                                               â”‚
  â”‚ authenticatedService.sendMessage(...)                         â”‚
  â”‚                                                               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RPC: sendMessage (no credentials!) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚             (Stub ID carries authentication)                  â”‚
  â”‚                                                               â”‚
  â”‚                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                     â”‚ Extract userId    â”‚
  â”‚                                                     â”‚ from stub context â”‚
  â”‚                                                     â”‚ Auto-add to task  â”‚
  â”‚                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                                                               â”‚
  â”œâ—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Task created (with userId metadata) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                               â”‚
  â”‚ 3. Dispose stub when done (revokes access)                    â”‚
  â”‚                                                               â”‚
  â”‚ authenticatedService.dispose()                                â”‚
  â”‚                                                               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RPC: dispose stub â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                                               â”‚
  â”‚                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                     â”‚ Remove stub      â”‚
  â”‚                                                     â”‚ Free resources   â”‚
  â”‚                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                                                               â”‚
  â–¼                                                               â–¼
  Further calls rejected (stub no longer exists)
```

### Color-Coded Event List

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EVENT LOG: Authentication and Capability-Based Access                       â”‚
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ #  â”‚ TIME     â”‚ TYPE     â”‚ EVENT DETAILS                                     â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 01 â”‚ 00:00.00 â”‚ ğŸ” AUTH  â”‚ CLIENT â†’ authenticate() Called                     â”‚
â”‚    â”‚          â”‚    REQ   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Credentials: {                                 â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   type: 'bearer',                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6...'     â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ }                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Request ID: auth-req-001                       â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 02 â”‚ 00:00.05 â”‚ ğŸ”· RPC   â”‚ SERVER â†’ A2AService.authenticate() Invoked         â”‚
â”‚    â”‚          â”‚   INVOKE â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Method: authenticate(credentials)              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Delegating to AuthenticationService            â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 03 â”‚ 00:00.07 â”‚ ğŸ” AUTH  â”‚ SERVER â†’ Token Validation                          â”‚
â”‚    â”‚          â”‚   VERIFY â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ AuthenticationService.authenticate()           â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ â€¢ Decode JWT token                             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ â€¢ Verify signature                             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ â€¢ Check expiration                             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ â€¢ Extract user claims                          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚                                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Result: {                                      â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   authenticated: true,                         â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   userId: 'user-alice-789',                    â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   permissions: ['read', 'write', 'execute'],   â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   expiresAt: '2025-11-15T09:45:23Z'           â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ }                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 04 â”‚ 00:00.10 â”‚ ğŸŸ£ CAP   â”‚ SERVER â†’ Create Capability Stub                    â”‚
â”‚    â”‚          â”‚    STUB  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ new AuthenticatedA2AService(                   â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   a2aService,                                  â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   taskManager,                                 â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   userId: 'user-alice-789',                    â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   permissions: ['read', 'write', 'execute']    â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ )                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚                                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Stub ID: auth-stub-alice-xyz123                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Methods exposed:                               â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   - sendMessage (with ownership checking)      â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   - getTask (with ownership checking)          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   - listTasks (filtered by userId)             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   - cancelTask (with ownership checking)       â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 05 â”‚ 00:00.12 â”‚ ğŸŸ  RPC   â”‚ SERVER â†’ Return Authenticated Stub                 â”‚
â”‚    â”‚          â”‚    RESP  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ {                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   "id": "auth-req-001",                        â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   "result": {                                  â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚     "__capnweb_stub__": true,                  â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚     "stubId": "auth-stub-alice-xyz123",        â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚     "type": "AuthenticatedA2AService",         â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚     "methods": [                               â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚       "sendMessage",                           â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚       "getTask",                               â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚       "listTasks",                             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚       "cancelTask"                             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚     ]                                          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   }                                            â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ }                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 06 â”‚ 00:00.15 â”‚ ğŸŸ¢ AUTH  â”‚ CLIENT â† Authenticated Stub Received               â”‚
â”‚    â”‚          â”‚    OK    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ authService = new AuthenticatedA2AServiceProxy(â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   stubId: 'auth-stub-alice-xyz123',            â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   connection: websocket,                       â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   methods: [...]                               â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ )                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚                                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ All future calls will use this stub!           â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ No more credential passing needed!             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚    â”‚          â”‚          â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚    â”‚          â”‚          â”‚ â•‘ USING AUTHENTICATED STUB                     â•‘ â”‚
â”‚    â”‚          â”‚          â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 07 â”‚ 00:00.20 â”‚ ğŸŸ¡ RPC   â”‚ CLIENT â†’ authService.sendMessage(...)              â”‚
â”‚    â”‚          â”‚    REQ   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Request routed to authenticated stub           â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ {                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   "id": "msg-req-002",                         â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   "stubId": "auth-stub-alice-xyz123",          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   "method": "sendMessage",                     â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   "params": {message: {...}}                   â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ }                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚                                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ NOTE: No credentials in this request!          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 08 â”‚ 00:00.25 â”‚ ğŸ”· RPC   â”‚ SERVER â†’ AuthenticatedA2AService.sendMessage()     â”‚
â”‚    â”‚          â”‚   INVOKE â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Stub context automatically provides:           â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   userId: 'user-alice-789'                     â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   permissions: ['read', 'write', 'execute']    â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚                                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Enriching message config with userId:          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   metadata.userId = 'user-alice-789'           â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 09 â”‚ 00:00.27 â”‚ ğŸŸ¢ TASK  â”‚ SERVER â†’ Task Created with User Context            â”‚
â”‚    â”‚          â”‚  CREATE  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Task ID: task-auth-001                         â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Metadata: {                                    â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   userId: 'user-alice-789',                    â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   createdBy: 'AuthenticatedA2AService'         â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ }                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚                                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Ownership automatically tracked!               â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 10 â”‚ 00:00.30 â”‚ ğŸŸ  RPC   â”‚ CLIENT â† Task Created                              â”‚
â”‚    â”‚          â”‚   RESP   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Task returned with userId in metadata          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Scenario 2: Error Handling - RPC Timeout

### Flow Diagram

```
Client                                                          Server
  â”‚                                                               â”‚
  â”‚ client.getTask("task-xyz")                                    â”‚
  â”‚                                                               â”‚
  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚ â”‚ â€¢ Generate request ID                                    â”‚  â”‚
  â”‚ â”‚ â€¢ Create promise                                         â”‚  â”‚
  â”‚ â”‚ â€¢ Set 30s timeout timer                                  â”‚  â”‚
  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RPC: getTask(task-xyz) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                                               â”‚
  â”‚                                                               âœ— (lost)
  â”‚
  â”‚
  â”‚ â° [30 seconds pass...]
  â”‚
  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ â”‚ Timeout fired!                                           â”‚
  â”‚ â”‚ â€¢ Remove from pendingRequests                            â”‚
  â”‚ â”‚ â€¢ Reject promise with timeout error                      â”‚
  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼ throw new Error('Request timeout: getTask')
  Application catches error
```

### Color-Coded Event List

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EVENT LOG: RPC Timeout Scenario                                             â”‚
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ #  â”‚ TIME     â”‚ TYPE     â”‚ EVENT DETAILS                                     â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 01 â”‚ 00:00.00 â”‚ ğŸŸ¡ RPC   â”‚ CLIENT â†’ getTask() Request                         â”‚
â”‚    â”‚          â”‚    REQ   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Request ID: timeout-test-001                   â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Method: getTask                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Params: {taskId: 'task-xyz'}                   â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Timeout: 30000ms                               â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 02 â”‚ 00:00.01 â”‚ ğŸ“¤ WS    â”‚ CLIENT â†’ Frame Sent                                â”‚
â”‚    â”‚          â”‚    OUT   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Size: 123 bytes                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Destination: server                            â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 03 â”‚ 00:00.05 â”‚ âš ï¸  NET  â”‚ NETWORK â†’ Packet Lost                              â”‚
â”‚    â”‚          â”‚   ERROR  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Frame never reaches server                     â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ (Simulated network failure)                    â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚    â”‚ [...]    â”‚          â”‚ [No response from server...]                       â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 04 â”‚ 00:30.00 â”‚ â° TIME  â”‚ CLIENT â†’ Timeout Fired                             â”‚
â”‚    â”‚          â”‚    OUT   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Timer expired: 30000ms                         â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Request ID: timeout-test-001                   â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Status: No response received                   â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 05 â”‚ 00:30.00 â”‚ ğŸ”´ ERROR â”‚ CLIENT â†’ Promise Rejected                          â”‚
â”‚    â”‚          â”‚          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Error: Request timeout: getTask                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Code: TIMEOUT                                  â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ RequestId: timeout-test-001                    â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Duration: 30000ms                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚                                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Cleanup:                                       â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   â€¢ Removed from pendingRequests map           â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   â€¢ Promise rejected                           â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   â€¢ Error thrown to caller                     â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 06 â”‚ 00:30.01 â”‚ âŒ APP   â”‚ APPLICATION â†’ Error Caught                         â”‚
â”‚    â”‚          â”‚   ERROR  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ try {                                          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   await client.getTask('task-xyz')             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ } catch (error) {                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   console.error('RPC failed:', error)          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   // Application can retry or show error       â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ }                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Scenario 3: Server-Side Error

### Color-Coded Event List

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EVENT LOG: Server Error During RPC Call                                     â”‚
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ #  â”‚ TIME     â”‚ TYPE     â”‚ EVENT DETAILS                                     â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 01 â”‚ 00:00.00 â”‚ ğŸŸ¡ RPC   â”‚ CLIENT â†’ cancelTask("completed-task-001")          â”‚
â”‚    â”‚          â”‚    REQ   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Request ID: cancel-req-001                     â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Method: cancelTask                             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Params: {taskId: 'completed-task-001'}         â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 02 â”‚ 00:00.05 â”‚ ğŸ”· RPC   â”‚ SERVER â†’ cancelTask() Invoked                      â”‚
â”‚    â”‚          â”‚   INVOKE â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ A2AService.cancelTask(taskId)                  â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Delegating to TaskManager                      â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 03 â”‚ 00:00.06 â”‚ ğŸ”´ ERROR â”‚ SERVER â†’ TaskManager Error                         â”‚
â”‚    â”‚          â”‚          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ TaskManager.cancelTask() threw:                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚                                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Error: Cannot cancel task in completed state   â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   at TaskManager.cancelTask (line 167)         â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   at A2AService.cancelTask (line 279)          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚                                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Task state: completed                          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Task ID: completed-task-001                    â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 04 â”‚ 00:00.07 â”‚ ğŸŸ£ RPC   â”‚ SERVER â†’ RPC Error Response                        â”‚
â”‚    â”‚          â”‚   ERROR  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Catch block in RPC handler                     â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Serializing error for client                   â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚                                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ {                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   "id": "cancel-req-001",                      â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   "error": {                                   â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚     "code": "TASK_ERROR",                      â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚     "message": "Cannot cancel task in         â”‚â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚                 completed state",              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚     "data": {                                  â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚       "taskId": "completed-task-001",          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚       "currentState": "completed"              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚     }                                          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   }                                            â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ }                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 05 â”‚ 00:00.08 â”‚ ğŸ“¤ WS    â”‚ SERVER â†’ Error Frame Sent                          â”‚
â”‚    â”‚          â”‚    OUT   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ WebSocket frame with error payload             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Size: 287 bytes                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 06 â”‚ 00:00.09 â”‚ ğŸ“¥ WS    â”‚ CLIENT â† Error Frame Received                      â”‚
â”‚    â”‚          â”‚    IN    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Parsed JSON with "error" field                 â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Matched to request ID: cancel-req-001          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 07 â”‚ 00:00.10 â”‚ ğŸ”´ RPC   â”‚ CLIENT â†’ Promise Rejected with Error               â”‚
â”‚    â”‚          â”‚   ERROR  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ pendingRequest.reject(                         â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   new Error(error.message)                     â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ )                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚                                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Error object passed to application:            â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   message: "Cannot cancel task..."             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   code: "TASK_ERROR"                           â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   data: {...}                                  â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 08 â”‚ 00:00.11 â”‚ âŒ APP   â”‚ APPLICATION â†’ Handle Error                         â”‚
â”‚    â”‚          â”‚   ERROR  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ try {                                          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   await client.cancelTask('completed-task-001')â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ } catch (error) {                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   if (error.code === 'TASK_ERROR') {           â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚     console.warn('Task cannot be canceled')    â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚     // Show user-friendly message              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   }                                            â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ }                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Scenario 4: Concurrent Connections - Multi-User

### Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONCURRENT CONNECTIONS: 3 Users                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  User: Alice                 User: Bob                  User: Charlie        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ A2AClient  â”‚              â”‚ A2AClient  â”‚             â”‚ A2AClient  â”‚      â”‚
â”‚  â”‚ :52341     â”‚              â”‚ :52342     â”‚             â”‚ :52343     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚        â”‚                           â”‚                          â”‚              â”‚
â”‚        â”‚   WS Frame                â”‚                          â”‚              â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚                          â”‚              â”‚
â”‚        â”‚            â”‚              â”‚  WS Frame                â”‚              â”‚
â”‚        â”‚            â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚              â”‚
â”‚        â”‚            â”‚              â”‚          â”‚               â”‚  WS Frame    â”‚
â”‚        â”‚            â”‚              â”‚          â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚        â–¼            â–¼              â–¼          â–¼               â–¼          â–¼   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                   WebSocket Server (Port 8080)                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚            â”‚              â”‚          â”‚               â”‚          â”‚   â”‚
â”‚        â”‚            â”‚              â”‚          â”‚               â”‚          â”‚   â”‚
â”‚   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â” â”‚
â”‚   â”‚ Conn #1 â”‚  â”‚ Msg #1 â”‚    â”‚ Conn #2â”‚ â”‚ Msg #2â”‚      â”‚ Conn #3â”‚ â”‚Msg#3â”‚ â”‚
â”‚   â”‚ Alice   â”‚  â”‚ Processâ”‚    â”‚ Bob    â”‚ â”‚Processâ”‚      â”‚Charlie â”‚ â”‚Proc â”‚ â”‚
â”‚   â”‚         â”‚  â”‚        â”‚    â”‚        â”‚ â”‚       â”‚      â”‚        â”‚ â”‚     â”‚ â”‚
â”‚   â”‚ Stub:   â”‚  â”‚ RPC:   â”‚    â”‚ Stub:  â”‚ â”‚ RPC:  â”‚      â”‚ Stub:  â”‚ â”‚RPC: â”‚ â”‚
â”‚   â”‚ auth-a  â”‚  â”‚ send   â”‚    â”‚ auth-b â”‚ â”‚getTaskâ”‚      â”‚ unauth â”‚ â”‚list â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â”‚
â”‚        â”‚           â”‚             â”‚         â”‚                â”‚         â”‚    â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                        â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                            â”‚  TaskManager   â”‚                               â”‚
â”‚                            â”‚  (Shared State)â”‚                               â”‚
â”‚                            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚
â”‚                            â”‚ Tasks:         â”‚                               â”‚
â”‚                            â”‚  alice-task-1  â”‚â”€â”€â–º userId: alice              â”‚
â”‚                            â”‚  alice-task-2  â”‚â”€â”€â–º userId: alice              â”‚
â”‚                            â”‚  bob-task-1    â”‚â”€â”€â–º userId: bob                â”‚
â”‚                            â”‚  charlie-task-1â”‚â”€â”€â–º no userId (unauth)         â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Color-Coded Timeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIMELINE: Concurrent Operations (3 users)                                   â”‚
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ #  â”‚ TIME     â”‚ USER     â”‚ EVENT                                             â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 01 â”‚ 00:00.00 â”‚ ğŸŸ¦ ALICE â”‚ Connect to server                                  â”‚
â”‚ 02 â”‚ 00:00.05 â”‚ ğŸŸ¦ ALICE â”‚ authenticate(token) â†’ auth-stub-alice              â”‚
â”‚ 03 â”‚ 00:00.10 â”‚ ğŸŸ© BOB   â”‚ Connect to server                                  â”‚
â”‚ 04 â”‚ 00:00.12 â”‚ ğŸŸ¦ ALICE â”‚ sendMessage("Task for Alice") â†’ task-alice-001     â”‚
â”‚ 05 â”‚ 00:00.15 â”‚ ğŸŸ© BOB   â”‚ authenticate(token) â†’ auth-stub-bob                â”‚
â”‚ 06 â”‚ 00:00.18 â”‚ ğŸŸª CHARLIEâ”‚ Connect to server (no auth)                       â”‚
â”‚ 07 â”‚ 00:00.20 â”‚ ğŸŸ© BOB   â”‚ sendMessage("Task for Bob") â†’ task-bob-001         â”‚
â”‚ 08 â”‚ 00:00.22 â”‚ ğŸŸ¦ ALICE â”‚ sendMessage("Another task") â†’ task-alice-002       â”‚
â”‚ 09 â”‚ 00:00.25 â”‚ ğŸŸª CHARLIEâ”‚ listTasks() â†’ sees all tasks (no filtering)       â”‚
â”‚ 10 â”‚ 00:00.28 â”‚ ğŸŸ¦ ALICE â”‚ listTasks() â†’ sees only alice-001, alice-002       â”‚
â”‚ 11 â”‚ 00:00.30 â”‚ ğŸŸ© BOB   â”‚ getTask("task-alice-001") â†’ FORBIDDEN error        â”‚
â”‚ 12 â”‚ 00:00.33 â”‚ ğŸŸ© BOB   â”‚ getTask("task-bob-001") â†’ success                  â”‚
â”‚ 13 â”‚ 00:00.35 â”‚ ğŸŸª CHARLIEâ”‚ sendMessage("Unauth task") â†’ task-charlie-001     â”‚
â”‚ 14 â”‚ 00:00.40 â”‚ ğŸŸ¦ ALICE â”‚ Task alice-001 â†’ completed                         â”‚
â”‚ 15 â”‚ 00:00.45 â”‚ ğŸŸ© BOB   â”‚ Task bob-001 â†’ completed                           â”‚
â”‚ 16 â”‚ 00:00.50 â”‚ ğŸŸ¦ ALICE â”‚ cancelTask("task-alice-001") â†’ error (completed)   â”‚
â”‚ 17 â”‚ 00:00.55 â”‚ ğŸŸ¦ ALICE â”‚ disconnect                                         â”‚
â”‚ 18 â”‚ 00:00.60 â”‚ ğŸŸª CHARLIEâ”‚ Task charlie-001 â†’ completed                      â”‚
â”‚ 19 â”‚ 00:01.00 â”‚ ğŸŸ© BOB   â”‚ disconnect                                         â”‚
â”‚ 20 â”‚ 00:01.10 â”‚ ğŸŸª CHARLIEâ”‚ disconnect                                        â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Key Observations:
â€¢ Each user has independent WebSocket connection
â€¢ Alice and Bob use authenticated stubs (filtered task access)
â€¢ Charlie uses unauthenticated service (sees all tasks)
â€¢ Bob cannot access Alice's task (ownership enforced)
â€¢ All operations happen concurrently on shared TaskManager
```

## Scenario 5: Connection Close During Active Streaming

### Color-Coded Event List

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EVENT LOG: Connection Closed During Streaming                               â”‚
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ #  â”‚ TIME     â”‚ TYPE     â”‚ EVENT DETAILS                                     â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 01 â”‚ 00:00.00 â”‚ ğŸŸ¡ RPC   â”‚ CLIENT â†’ sendMessageStreaming()                    â”‚
â”‚ 02 â”‚ 00:00.05 â”‚ ğŸŸ£ STREAMâ”‚ SERVER â†’ StreamingTask created                     â”‚
â”‚ 03 â”‚ 00:00.07 â”‚ ğŸŸ£ STREAMâ”‚ CLIENT â†’ subscribe(callback)                       â”‚
â”‚ 04 â”‚ 00:00.10 â”‚ ğŸ”µ PUSH  â”‚ SERVER â†’ Push: status=submitted                    â”‚
â”‚ 05 â”‚ 00:00.12 â”‚ ğŸ”µ PUSH  â”‚ SERVER â†’ Push: status=working                      â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚    â”‚          â”‚          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ [Task processing in background...]             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 06 â”‚ 00:00.50 â”‚ âš ï¸  WS   â”‚ NETWORK â†’ Connection Interrupted                   â”‚
â”‚    â”‚          â”‚   CLOSE  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ WebSocket close frame received                 â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Code: 1001 (Going Away)                        â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Reason: "User closed browser"                  â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 07 â”‚ 00:00.51 â”‚ ğŸ”´ CLIENTâ”‚ CLIENT â†’ All Pending Requests Rejected             â”‚
â”‚    â”‚          â”‚   CLEANUPâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ for (const req of pendingRequests) {           â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   clearTimeout(req.timer)                      â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   req.reject(new Error('Connection closed'))   â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ }                                              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ pendingRequests.clear()                        â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 08 â”‚ 00:00.52 â”‚ ğŸ”´ SERVERâ”‚ SERVER â†’ WebSocket 'close' Event                   â”‚
â”‚    â”‚          â”‚   CLEANUPâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ ws.on('close', () => {                         â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   // Stop all streaming tasks for this conn    â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   streamingTask.stopMonitoring()               â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   streamingTask.callbacks.clear()              â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   // Dispose stubs                             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚   authenticatedStub?.dispose()                 â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ })                                             â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 09 â”‚ 00:00.53 â”‚ âš« CONN  â”‚ Connection Fully Closed                            â”‚
â”‚    â”‚          â”‚   CLOSED â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ TCP connection terminated                      â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ All resources freed                            â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚                                                â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ NOTE: Task continues processing on server!     â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Client can reconnect and call getTask() later  â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â”‚ 10 â”‚ 00:01.00 â”‚ ğŸ”µ STATUSâ”‚ SERVER â†’ Task Completes (no listeners)             â”‚
â”‚    â”‚          â”‚   UPDATE â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Task state: completed                          â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ No callbacks to notify (all unsubscribed)      â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â”‚ Task stored in TaskManager for later retrieval â”‚ â”‚
â”‚    â”‚          â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚          â”‚          â”‚                                                    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Summary: Event Type Reference

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUICK REFERENCE: Event Types and Colors                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ COLOR/SYMBOL â”‚ MEANING                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”µ BLUE      â”‚ Connection events (TCP, WebSocket)                            â”‚
â”‚ ğŸŸ¢ GREEN     â”‚ Success states (connected, task created, completed)           â”‚
â”‚ ğŸ”´ RED       â”‚ Errors (connection failed, task failed, RPC error)            â”‚
â”‚ ğŸŸ¡ YELLOW    â”‚ RPC requests, task processing                                 â”‚
â”‚ ğŸŸ  ORANGE    â”‚ RPC responses, authentication                                 â”‚
â”‚ ğŸŸ£ PURPLE    â”‚ Streaming/RPC stubs, capabilities                             â”‚
â”‚ ğŸ”· CYAN      â”‚ RPC method invocation (server-side)                           â”‚
â”‚ ğŸŸª MAGENTA   â”‚ Third-party user actions                                      â”‚
â”‚ ğŸ“¤ CYAN      â”‚ Outgoing WebSocket frames                                     â”‚
â”‚ ğŸ“¥ MAGENTA   â”‚ Incoming WebSocket frames                                     â”‚
â”‚ ğŸ” ORANGE    â”‚ Authentication/authorization                                  â”‚
â”‚ âš ï¸  YELLOW   â”‚ Warnings, non-critical issues                                 â”‚
â”‚ â° CLOCK     â”‚ Timeout events                                                â”‚
â”‚ âš« BLACK     â”‚ Connection termination                                        â”‚
â”‚ âœ… CHECK     â”‚ Operation completed successfully                              â”‚
â”‚ âŒ X         â”‚ Operation failed                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
